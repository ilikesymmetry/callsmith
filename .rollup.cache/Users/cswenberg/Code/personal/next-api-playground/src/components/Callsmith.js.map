{"version":3,"file":"Callsmith.js","sourceRoot":"","sources":["Callsmith.tsx"],"names":[],"mappings":"AAAA,YAAY,CAAC;;;AAEb,OAAO,EAGL,oBAAoB,GAGrB,MAAM,aAAa,CAAC;AACrB,OAAO,EAAE,MAAM,EAAE,MAAM,UAAU,CAAC;AAClC,OAAO,EAAE,IAAI,EAAE,QAAQ,EAAE,MAAM,oBAAoB,CAAC;AACpD,OAAO,EAAE,QAAQ,EAAE,MAAM,YAAY,CAAC;AACtC,OAAO,EACL,eAAe,EACf,cAAc,EACd,mBAAmB,GACpB,MAAM,gBAAgB,CAAC;AACxB,OAAO,EAAE,SAAS,EAAE,MAAM,gBAAgB,CAAC;AAC3C,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,MAAM,aAAa,CAAC;AACrD,OAAO,EAAE,eAAe,EAAE,MAAM,WAAW,CAAC;AAC5C,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;AAC9C,OAAO,IAAI,MAAM,WAAW,CAAC;AAC7B,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAE1C,SAAS,OAAO,CACd,KAAsB,EACtB,MAAiD;IAEjD,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,MAAM,CAAC,IAAI,CAAC,CAAC;IACvC,QAAQ,MAAM,CAAC,IAAI,EAAE,CAAC;QACpB,KAAK,oBAAoB,CAAC,WAAW;YACnC,KAAK,CAAC,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC;YAClC,OAAO;QACT,KAAK,oBAAoB,CAAC,UAAU;YAClC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC;YACvD,OAAO;QACT,KAAK,oBAAoB,CAAC,QAAQ;YAChC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI,CAAC;YACrD,OAAO;QACT,KAAK,oBAAoB,CAAC,SAAS;YACjC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,KAAK,GAAG,MAAM,CAAC,IAAI,CAAC;YACtD,OAAO;QACT,KAAK,oBAAoB,CAAC,WAAW;YACnC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,OAAO,GAAG,MAAM,CAAC,IAAI,CAAC;YACxD,OAAO;QACT,KAAK,oBAAoB,CAAC,eAAe;YACvC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC;YACvD,OAAO;QACT,KAAK,oBAAoB,CAAC,YAAY;YACpC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC,YAAY,GAAG,MAAM,CAAC,IAAI,CAAC;YAC7D,OAAO;IACX,CAAC;AACH,CAAC;AAED,MAAM,UAAU,aAAa,CAC3B,QAAuB,EACvB,QAAqB;IAArB,yBAAA,EAAA,aAAqB;IAErB,IAAM,MAAM,GAAiB,EAAE,CAAC;IAChC,IAAM,UAAU,GAAG;QACjB,OAAO,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QACjC,KAAK,EAAE,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC;QAC/B,IAAI,EAAE,EAAE;KACT,CAAC;IAEF,QAAQ,CAAC,OAAO,CAAC,UAAC,IAAI;QACpB,IAAM,WAAW,GACf,QAAQ,KAAK,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,QAAQ,EAAE,IAAI,CAAC,KAAK,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAElE,IAAI,IAAI,CAAC,IAAI,KAAK,MAAM,IAAI,IAAI,CAAC,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAC1D,MAAM,CAAC,IAAI,qBACT,IAAI,EAAE,WAAW,EACjB,MAAM,EAAE,IAAI,CAAC,IAAI,CAAC,MAAgB,IAC/B,UAAU,KACb,MAAM,EAAE,WAAW;qBAChB,KAAK,CAAC,GAAG,CAAC;qBACV,GAAG,CAAC,UAAC,IAAI,IAAK,OAAA,WAAW,CAAC,IAAI,CAAC,EAAjB,CAAiB,CAAC;qBAChC,MAAM,CAAC,UAAC,KAAK,IAAK,OAAA,KAAK,CAAC,SAAS,EAAf,CAAe,CAAC;qBAClC,GAAG,CAAC,UAAC,KAAK,IAAK,OAAA,CAAC,EAAE,GAAG,EAAE,KAAK,CAAC,KAAK,EAAE,KAAK,EAAE,EAAE,EAAE,CAAC,EAAjC,CAAiC,CAAC,IACpD,CAAC;QACL,CAAC;QAED,IAAI,IAAI,CAAC,QAAQ,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC;YAC7B,MAAM,CAAC,IAAI,OAAX,MAAM,EAAS,aAAa,CAAC,IAAI,CAAC,QAAQ,EAAE,WAAW,CAAC,EAAE;QAC5D,CAAC;IACH,CAAC,CAAC,CAAC;IAEH,OAAO,MAAM,CAAC;AAChB,CAAC;AAED,MAAM,UAAU,SAAS,CAAC,EAAmC;QAAjC,KAAK,WAAA;IAC/B,+BAA+B;IAC/B,IAAM,SAAS,GAAG,aAAa,CAAC,KAAK,CAAC,CAAC;IACvC,uCAAuC;IAEvC,IAAM,YAAY,GAAG,SAAS,CAAC,MAAM,CACnC,UAAC,GAAoB,EAAE,KAAK;QAC1B,GAAG,CAAC,MAAM,CAAC,UAAG,KAAK,CAAC,MAAM,cAAI,KAAK,CAAC,IAAI,CAAE,CAAC,GAAG,KAAK,CAAC;QACpD,OAAO,GAAG,CAAC;IACb,CAAC,EACD;QACE,aAAa,EACX,SAAS,CAAC,MAAM,GAAG,CAAC;YAClB,CAAC,CAAC,UAAG,SAAS,CAAC,CAAC,CAAC,CAAC,MAAM,cAAI,SAAS,CAAC,CAAC,CAAC,CAAC,IAAI,CAAE;YAC/C,CAAC,CAAC,MAAM;QACZ,MAAM,EAAE,EAAE;KACX,CACF,CAAC;IACI,IAAA,KAAoB,eAAe,CACvC,OAAO,EACP,YAAY;IACZ,cAAc;IACd,wDAAwD;IACxD,6DAA6D;IAC7D,IAAI;KACL,EAPM,KAAK,QAAA,EAAE,QAAQ,QAOrB,CAAC;IAEF,iDAAiD;IACjD,oBAAoB;IACpB,6DAA6D;IAC7D,eAAe;IAEf,+BAA+B;IAE/B,OAAO,CACL,eAAM,SAAS,EAAC,+CAA+C,YAC7D,MAAC,mBAAmB,IAClB,SAAS,EAAC,YAAY,EACtB,SAAS,EAAC,6BAA6B,aAEvC,MAAC,cAAc,IACb,WAAW,EAAE,EAAE,EACf,OAAO,EAAE,EAAE,EACX,OAAO,EAAE,EAAE,EACX,SAAS,EAAC,UAAU,aAEpB,cAAK,SAAS,EAAC,4BAA4B,uBAAa,EACxD,KAAC,UAAU,IAAC,SAAS,EAAC,uBAAuB,YAC3C,KAAC,IAAI,IACH,KAAK,EAAE,KAAK,CAAC,aAAa,EAC1B,aAAa,EAAE,UAAC,KAAK;oCACnB,OAAA,QAAQ,CAAC;wCACP,IAAI,EAAE,oBAAoB,CAAC,WAAW;wCACtC,IAAI,EAAE,KAAK;qCACZ,CAAC;gCAHF,CAGE,YAGJ,KAAC,SAAS,IACR,IAAI,EAAC,UAAU,EACf,SAAS,EAAC,QAAQ,EAClB,YAAY,EAAE,KAAK,CAAC,GAAG,CAAC,UAAC,CAAC,IAAK,OAAA,CAAC,CAAC,KAAK,EAAP,CAAO,CAAC,YAEvC,KAAC,QAAQ,cACN,KAAK,CAAC,GAAG,CAAC,UAAC,IAAI,EAAE,CAAC;;4CAAK,OAAA,CACtB,KAAC,MAAM,IAKL,MAAM,EAAC,EAAE,EACT,IAAI,EAAE,IAAI,IALL,UAAG,MAAA,IAAI,CAAC,IAAI,0CAAE,MAAM,cAAI,SAAS,CAAC;gDACrC,EAAE;gDACF,IAAI,CAAC,KAAK;6CACX,CAAC,cAAI,CAAC,CAAE,CAGT,CACH,CAAA;yCAAA,CAAC,GACO,GACD,GACP,GACI,EACb,cAAK,SAAS,EAAC,oCAAoC,YACjD,KAAC,UAAU,cACT,eAAK,SAAS,EAAC,iEAAiE,wBACtE,GAAG,EACX,KAAC,IAAI,IACH,IAAI,EAAC,mCAAmC,EACxC,MAAM,EAAC,QAAQ,EACf,SAAS,EAAC,iBAAiB,+BAGtB,IACH,GACK,GACT,IACS,EACjB,KAAC,eAAe,KAAG,EACnB,KAAC,cAAc,IAAC,WAAW,EAAE,EAAE,EAAE,SAAS,EAAC,EAAE,YAC3C,KAAC,QAAQ,IAAC,KAAK,EAAE,KAAK,EAAE,QAAQ,EAAE,QAAQ,GAAI,GAC/B,IACG,GACjB,CACR,CAAC;AACJ,CAAC","sourcesContent":["\"use client\";\n\nimport {\n  ApiPathNode,\n  Method,\n  PlaygroundActionType,\n  PlaygroundState,\n  RouteState,\n} from \"@/lib/types\";\nimport { ApiTab } from \"./ApiTab\";\nimport { Tabs, TabsList } from \"./ui/tabs-vertical\";\nimport { ApiRoute } from \"./ApiRoute\";\nimport {\n  ResizableHandle,\n  ResizablePanel,\n  ResizablePanelGroup,\n} from \"./ui/resizable\";\nimport { Accordion } from \"./ui/accordion\";\nimport { extractPath, joinPaths } from \"@/lib/utils\";\nimport { useImmerReducer } from \"use-immer\";\nimport { ScrollArea } from \"./ui/scroll-area\";\nimport Link from \"next/link\";\nimport { ContentBox } from \"./ContentBox\";\n\nfunction reducer(\n  draft: PlaygroundState,\n  action: { type: PlaygroundActionType; data: any }\n) {\n  console.log(\"new action\", action.type);\n  switch (action.type) {\n    case PlaygroundActionType.SelectRoute:\n      draft.selectedRoute = action.data;\n      return;\n    case PlaygroundActionType.EditMethod:\n      draft.routes[draft.selectedRoute].method = action.data;\n      return;\n    case PlaygroundActionType.EditBody:\n      draft.routes[draft.selectedRoute].body = action.data;\n      return;\n    case PlaygroundActionType.EditQuery:\n      draft.routes[draft.selectedRoute].query = action.data;\n      return;\n    case PlaygroundActionType.EditHeaders:\n      draft.routes[draft.selectedRoute].headers = action.data;\n      return;\n    case PlaygroundActionType.EditRouteParams:\n      draft.routes[draft.selectedRoute].params = action.data;\n      return;\n    case PlaygroundActionType.HttpResponse:\n      draft.routes[draft.selectedRoute].lastResponse = action.data;\n      return;\n  }\n}\n\nexport function extractRoutes(\n  fileTree: ApiPathNode[],\n  basePath: string = \"\"\n): RouteState[] {\n  const routes: RouteState[] = [];\n  const emptyState = {\n    headers: [{ key: \"\", value: \"\" }],\n    query: [{ key: \"\", value: \"\" }],\n    body: \"\",\n  };\n\n  fileTree.forEach((node) => {\n    const currentPath =\n      basePath === \"\" ? node.value : [basePath, node.value].join(\"/\");\n\n    if (node.type === \"file\" && node.data && node.data.method) {\n      routes.push({\n        path: currentPath,\n        method: node.data.method as Method,\n        ...emptyState,\n        params: currentPath\n          .split(\"/\")\n          .map((name) => extractPath(name))\n          .filter((route) => route.isDynamic)\n          .map((route) => ({ key: route.value, value: \"\" })),\n      });\n    }\n\n    if (node.children.length > 0) {\n      routes.push(...extractRoutes(node.children, currentPath));\n    }\n  });\n\n  return routes;\n}\n\nexport function Callsmith({ nodes }: { nodes: ApiPathNode[] }) {\n  // console.log(\"nodes\", nodes);\n  const extracted = extractRoutes(nodes);\n  // console.log(\"extracted\", extracted);\n\n  const initialState = extracted.reduce(\n    (acc: PlaygroundState, route) => {\n      acc.routes[`${route.method}:${route.path}`] = route;\n      return acc;\n    },\n    {\n      selectedRoute:\n        extracted.length > 0\n          ? `${extracted[0].method}:${extracted[0].path}`\n          : \"null\",\n      routes: {},\n    }\n  );\n  const [state, dispatch] = useImmerReducer(\n    reducer,\n    initialState\n    //   , () => {\n    //   const localData = localStorage.getItem(\"appState\");\n    //   return localData ? JSON.parse(localData) : initialState;\n    // }\n  );\n\n  // Save state to localStorage whenever it changes\n  // useEffect(() => {\n  //   localStorage.setItem(\"appState\", JSON.stringify(state));\n  // }, [state]);\n\n  // console.log(\"state\", state);\n\n  return (\n    <main className=\"dark:bg-black dark:text-white overflow-hidden\">\n      <ResizablePanelGroup\n        direction=\"horizontal\"\n        className=\"min-h-[100vh] min-w-[100vw]\"\n      >\n        <ResizablePanel\n          defaultSize={25}\n          minSize={10}\n          maxSize={40}\n          className=\"relative\"\n        >\n          <div className=\"py-4 px-6 text-neutral-400\">Routes</div>\n          <ScrollArea className=\"h-[calc(100vh-120px)]\">\n            <Tabs\n              value={state.selectedRoute}\n              onValueChange={(route) =>\n                dispatch({\n                  type: PlaygroundActionType.SelectRoute,\n                  data: route,\n                })\n              }\n            >\n              <Accordion\n                type=\"multiple\"\n                className=\"w-full\"\n                defaultValue={nodes.map((n) => n.value)}\n              >\n                <TabsList>\n                  {nodes.map((node, i) => (\n                    <ApiTab\n                      key={`${node.data?.method}:${joinPaths([\n                        \"\",\n                        node.value,\n                      ])}-${i}`}\n                      prefix=\"\"\n                      node={node}\n                    />\n                  ))}\n                </TabsList>\n              </Accordion>\n            </Tabs>\n          </ScrollArea>\n          <div className=\"absolute bottom-0 px-8 py-4 w-full\">\n            <ContentBox>\n              <div className=\"py-2 text-center text-sm text-neutral-600 dark:text-neutral-400\">\n                Made by{\" \"}\n                <Link\n                  href=\"https://twitter.com/ilikesymmetry\"\n                  target=\"_blank\"\n                  className=\"hover:underline\"\n                >\n                  @ilikesymmetry\n                </Link>\n              </div>\n            </ContentBox>\n          </div>\n        </ResizablePanel>\n        <ResizableHandle />\n        <ResizablePanel defaultSize={75} className=\"\">\n          <ApiRoute state={state} dispatch={dispatch} />\n        </ResizablePanel>\n      </ResizablePanelGroup>\n    </main>\n  );\n}\n"]}