{"version":3,"file":"ApiRoute.js","sourceRoot":"","sources":["ApiRoute.tsx"],"names":[],"mappings":";;AAAA,OAAO,EAAY,WAAW,EAAa,QAAQ,EAAE,MAAM,OAAO,CAAC;AACnE,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,QAAQ,EAAE,WAAW,EAAE,MAAM,sBAAsB,CAAC;AAChF,OAAO,EACL,eAAe,EACf,cAAc,EACd,mBAAmB,GACpB,MAAM,gBAAgB,CAAC;AACxB,OAAO,EAAE,MAAM,EAAE,MAAM,aAAa,CAAC;AACrC,OAAO,EAAE,YAAY,EAAE,MAAM,gBAAgB,CAAC;AAC9C,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAC1C,OAAO,EAEL,oBAAoB,GAGrB,MAAM,cAAc,CAAC;AACtB,OAAO,EAAE,WAAW,EAAE,MAAM,cAAc,CAAC;AAC3C,OAAO,EAAE,eAAe,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAE,eAAe,EAAE,MAAM,mBAAmB,CAAC;AACpD,OAAO,EAAE,gBAAgB,EAAE,MAAM,oBAAoB,CAAC;AACtD,OAAO,EAAE,UAAU,EAAE,MAAM,kBAAkB,CAAC;AAC9C,OAAO,EAAE,UAAU,EAAE,MAAM,cAAc,CAAC;AAE1C,MAAM,UAAU,QAAQ,CAAC,EAMxB;IAND,iBAgLC;QA/KC,KAAK,WAAA,EACL,QAAQ,cAAA;IAKR,IAAM,KAAK,GAAG,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,aAAa,CAAC,CAAC;IAEhD,IAAM,YAAY,GAAG,WAAW,CAAC,UAAC,CAAS;QACzC,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,CAAC,QAAQ,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;IAC7D,CAAC,EAAE,EAAE,CAAC,CAAC;IACP,IAAM,aAAa,GAAG,WAAW,CAAC,UAAC,CAAa;QAC9C,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,CAAC,SAAS,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;IAC9D,CAAC,EAAE,EAAE,CAAC,CAAC;IACP,IAAM,eAAe,GAAG,WAAW,CAAC,UAAC,CAAa;QAChD,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,CAAC,WAAW,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;IAChE,CAAC,EAAE,EAAE,CAAC,CAAC;IACP,IAAM,mBAAmB,GAAG,WAAW,CAAC,UAAC,CAAa;QACpD,QAAQ,CAAC,EAAE,IAAI,EAAE,oBAAoB,CAAC,eAAe,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC;IACpE,CAAC,EAAE,EAAE,CAAC,CAAC;IAED,IAAA,KAAwB,QAAQ,CAAU,KAAK,CAAC,EAA/C,OAAO,QAAA,EAAE,UAAU,QAA4B,CAAC;IAEvD,IAAM,aAAa,GAAG,UAAO,KAAiB;;;;;oBAC5C,UAAU,CAAC,IAAI,CAAC,CAAC;;;;oBAET,IAAI,GAAG,KAAK,CAAC,IAAI;yBACpB,KAAK,CAAC,GAAG,CAAC;yBACV,KAAK,CAAC,UAAC,IAAI,IAAK,OAAA,CAAC,WAAW,CAAC,IAAI,CAAC,CAAC,SAAS,EAA5B,CAA4B,CAAC;wBAC9C,CAAC,CAAC,KAAK,CAAC,IAAI;wBACZ,CAAC,CAAC,KAAK,CAAC,IAAI;6BACP,KAAK,CAAC,GAAG,CAAC;6BACV,GAAG,CAAC,UAAC,IAAI;;4BACF,IAAA,KAAuB,WAAW,CAAC,IAAI,CAAC,EAAtC,SAAS,eAAA,EAAE,KAAK,WAAsB,CAAC;4BAC/C,IAAI,SAAS,EAAE,CAAC;gCACd,OAAO,MAAA,KAAK,CAAC,MAAM,CAAC,IAAI,CAAC,UAAC,EAAE,IAAK,OAAA,EAAE,CAAC,GAAG,KAAK,KAAK,EAAhB,CAAgB,CAAC,0CAAE,KAAK,CAAC;4BAC5D,CAAC;iCAAM,CAAC;gCACN,OAAO,KAAK,CAAC;4BACf,CAAC;wBACH,CAAC,CAAC;6BACD,IAAI,CAAC,GAAG,CAAC,CAAC;oBACX,KAAK,GACT,KAAK,CAAC,KAAK,CAAC,MAAM,CAAC,UAAC,EAAE,IAAK,OAAA,EAAE,CAAC,GAAG,KAAK,EAAE,EAAb,CAAa,CAAC,CAAC,MAAM,KAAK,CAAC;wBACpD,CAAC,CAAC,EAAE;wBACJ,CAAC,CAAC,KAAK,CAAC,KAAK,CAAC,GAAG,CAAC,UAAC,EAAc;gCAAZ,GAAG,SAAA,EAAE,KAAK,WAAA;4BAAO,OAAA,UAAG,GAAG,cAAI,KAAK,CAAE;wBAAjB,CAAiB,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;oBAC3D,qBAAM,KAAK,CAAC,WAAI,IAAI,SAAG,KAAK,CAAC,CAAC,CAAC,GAAG,GAAG,KAAK,CAAC,CAAC,CAAC,EAAE,CAAE,EAAE;4BAC7D,MAAM,EAAE,KAAK,CAAC,MAAM;4BACpB,IAAI,EAAE,KAAK,CAAC,MAAM,KAAK,KAAK,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC,IAAI;yBACjD,CAAC,EAAA;;oBAHI,GAAG,GAAG,SAGV;oBACE,IAAI,SAAA,CAAC;;;;oBAEA,qBAAM,GAAG,CAAC,IAAI,EAAE,EAAA;;oBAAvB,IAAI,GAAG,SAAgB,CAAC;;;;oBAExB,IAAI,GAAG,sCAAsC,CAAC;;;oBAEhD,qBAAqB;oBACrB,QAAQ,CAAC;wBACP,IAAI,EAAE,oBAAoB,CAAC,YAAY;wBACvC,IAAI,EAAE,EAAE,MAAM,EAAE,GAAG,CAAC,MAAM,EAAE,IAAI,MAAA,EAAE;qBACnC,CAAC,CAAC;;;;oBAEH,OAAO,CAAC,GAAG,CAAC,GAAC,CAAC,CAAC;;;oBAEjB,UAAU,CAAC,KAAK,CAAC,CAAC;;;;SACnB,CAAC;IAEF,IAAM,SAAS,GAAG,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;IAExC,OAAO,CACL,MAAC,mBAAmB,IAAC,SAAS,EAAC,UAAU,EAAC,SAAS,EAAC,EAAE,aACpD,MAAC,cAAc,IAAC,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAC,WAAW,aAChE,cAAK,SAAS,EAAC,uBAAuB,wBAAc,EACpD,eAAK,SAAS,EAAC,mCAAmC,aAChD,eAAK,SAAS,EAAC,6BAA6B,aAC1C,KAAC,eAAe,IAAC,MAAM,EAAE,KAAK,CAAC,MAAM,YAClC,KAAK,CAAC,MAAM,GACG,EAClB,cAAK,SAAS,EAAC,2BAA2B,YACvC,SAAS,CAAC,GAAG,CAAC,UAAC,IAAI,EAAE,CAAC,IAAK,OAAA,CAC1B,KAAC,gBAAgB,IAAsB,IAAI,EAAE,IAAI,IAA1B,UAAG,IAAI,cAAI,CAAC,CAAE,CAAgB,CACtD,EAF2B,CAE3B,CAAC,GACE,IACF,EACN,KAAC,MAAM,IAAC,OAAO,EAAE,OAAO,EAAE,OAAO,EAAE,cAAM,OAAA,aAAa,CAAC,KAAK,CAAC,EAApB,CAAoB,qBAEpD,IACL,EACN,MAAC,IAAI,IAAC,SAAS,EAAC,aAAa,EAAC,YAAY,EAAC,SAAS,aAClD,MAAC,QAAQ,eACP,KAAC,WAAW,IAAC,KAAK,EAAC,SAAS,wBAAsB,EAClD,KAAC,WAAW,IAAC,KAAK,EAAC,OAAO,sBAAoB,EAC9C,KAAC,WAAW,IAAC,KAAK,EAAC,MAAM,qBAAmB,EAC5C,KAAC,WAAW,IACV,KAAK,EAAC,QAAQ,EACd,SAAS,EACP,KAAK,CAAC,IAAI;6CACP,KAAK,CAAC,GAAG,CAAC;6CACV,IAAI,CAAC,UAAC,IAAI,IAAK,OAAA,WAAW,CAAC,IAAI,CAAC,CAAC,SAAS,EAA3B,CAA2B,CAAC;4CAC5C,CAAC,CAAC,EAAE;4CACJ,CAAC,CAAC,QAAQ,EAEd,KAAK,EAAE,CAAC,KAAK,CAAC,MAAM,CAAC,KAAK,CAAC,UAAC,EAAE,IAAK,OAAA,CAAC,CAAC,EAAE,CAAC,KAAK,EAAV,CAAU,CAAC,uBAGlC,IACL,EACX,eAAK,SAAS,EAAC,cAAc,aAC3B,KAAC,WAAW,IAAC,KAAK,EAAC,SAAS,EAAC,SAAS,EAAC,QAAQ,YAC7C,KAAC,UAAU,IAAC,SAAS,EAAC,QAAQ,YAC5B,KAAC,YAAY,IACX,SAAS,EAAE,KAAK,CAAC,OAAO,EACxB,YAAY,EAAE,eAAe,GAC7B,GACS,GACD,EACd,KAAC,WAAW,IAAC,KAAK,EAAC,OAAO,EAAC,SAAS,EAAC,QAAQ,YAC3C,KAAC,UAAU,IAAC,SAAS,EAAC,QAAQ,YAC5B,KAAC,YAAY,IACX,SAAS,EAAE,KAAK,CAAC,KAAK,EACtB,YAAY,EAAE,aAAa,GAC3B,GACS,GACD,EACd,KAAC,WAAW,IAAC,KAAK,EAAC,MAAM,EAAC,SAAS,EAAC,QAAQ,YAC1C,KAAC,UAAU,cACT,KAAC,UAAU,IAAC,SAAS,EAAC,QAAQ,YAC5B,KAAC,UAAU,IAAC,KAAK,EAAE,KAAK,CAAC,IAAI,EAAE,QAAQ,EAAE,YAAY,GAAI,GAC9C,GACF,GACD,EACd,KAAC,WAAW,IAAC,KAAK,EAAC,QAAQ,EAAC,SAAS,EAAC,QAAQ,YAC5C,KAAC,UAAU,IAAC,SAAS,EAAC,QAAQ,YAC5B,KAAC,YAAY,IACX,SAAS,EAAE,KAAK,CAAC,MAAM,EACvB,YAAY,EAAE,mBAAmB,EACjC,QAAQ,SACR,GACS,GACD,IACV,IACD,IACQ,EACjB,KAAC,eAAe,KAAG,EACnB,MAAC,cAAc,IAAC,WAAW,EAAE,EAAE,EAAE,OAAO,EAAE,CAAC,EAAE,SAAS,EAAC,WAAW,aAChE,cAAK,SAAS,EAAC,uBAAuB,yBAAe,EACpD,CAAC,CAAC,KAAK,CAAC,YAAY,CAAC,CAAC,CAAC,CACtB,eAAK,SAAS,EAAC,qBAAqB,aAClC,cAAK,SAAS,EAAC,MAAM,YACnB,KAAC,eAAe,IAAC,IAAI,EAAE,KAAK,CAAC,YAAa,CAAC,MAAM,GAAI,GACjD,EACN,cAAK,SAAS,EAAC,oBAAoB,YACjC,KAAC,UAAU,cACT,KAAC,UAAU,IAAC,SAAS,EAAC,QAAQ,YAC5B,KAAC,UAAU,IACT,KAAK,EAAE,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,YAAa,CAAC,IAAI,CAAC,GAE/C,GACS,GACF,GACT,IACF,CACP,CAAC,CAAC,CAAC,CACF,cAAK,SAAS,EAAC,qBAAqB,YAClC,KAAC,UAAU,cACT,cAAK,SAAS,EAAC,mGAAmG,YAC/G,OAAO;oCACN,CAAC,CAAC,sBAAsB;oCACxB,CAAC,CAAC,8BAA8B,GAC9B,GACK,GACT,CACP,IACc,IACG,CACvB,CAAC;AACJ,CAAC","sourcesContent":["import { Dispatch, useCallback, useEffect, useState } from \"react\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"./ui/tabs-horizontal\";\nimport {\n  ResizableHandle,\n  ResizablePanel,\n  ResizablePanelGroup,\n} from \"./ui/resizable\";\nimport { Button } from \"./ui/button\";\nimport { KeyValueForm } from \"./KeyValueForm\";\nimport { JsonEditor } from \"./JsonEditor\";\nimport {\n  KeyValue,\n  PlaygroundActionType,\n  PlaygroundState,\n  RouteState,\n} from \"../lib/types\";\nimport { extractPath } from \"../lib/utils\";\nimport { HttpStatusBadge } from \"./HttpStatusBadge\";\nimport { HttpMethodBadge } from \"./HttpMethodBadge\";\nimport { ApiRoutePathNode } from \"./ApiRoutePathNode\";\nimport { ScrollArea } from \"./ui/scroll-area\";\nimport { ContentBox } from \"./ContentBox\";\n\nexport function ApiRoute({\n  state,\n  dispatch,\n}: {\n  state: PlaygroundState;\n  dispatch: Dispatch<{ type: PlaygroundActionType; data: any }>;\n}) {\n  const route = state.routes[state.selectedRoute];\n\n  const onBodyChange = useCallback((v: string) => {\n    dispatch({ type: PlaygroundActionType.EditBody, data: v });\n  }, []);\n  const onQueryChange = useCallback((v: KeyValue[]) => {\n    dispatch({ type: PlaygroundActionType.EditQuery, data: v });\n  }, []);\n  const onHeadersChange = useCallback((v: KeyValue[]) => {\n    dispatch({ type: PlaygroundActionType.EditHeaders, data: v });\n  }, []);\n  const onRouteParamsChange = useCallback((v: KeyValue[]) => {\n    dispatch({ type: PlaygroundActionType.EditRouteParams, data: v });\n  }, []);\n\n  const [loading, setLoading] = useState<boolean>(false);\n\n  const submitRequest = async (route: RouteState) => {\n    setLoading(true);\n    try {\n      const path = route.path\n        .split(\"/\")\n        .every((name) => !extractPath(name).isDynamic)\n        ? route.path\n        : route.path\n            .split(\"/\")\n            .map((name) => {\n              const { isDynamic, value } = extractPath(name);\n              if (isDynamic) {\n                return route.params.find((kv) => kv.key === value)?.value;\n              } else {\n                return value;\n              }\n            })\n            .join(\"/\");\n      const query =\n        route.query.filter((kv) => kv.key !== \"\").length === 0\n          ? \"\"\n          : route.query.map(({ key, value }) => `${key}=${value}`).join(\"&\");\n      const res = await fetch(`/${path}${query ? \"?\" + query : \"\"}`, {\n        method: route.method,\n        body: route.method !== \"GET\" ? route.body : null,\n      });\n      let data;\n      try {\n        data = await res.json();\n      } catch {\n        data = \"Unknown error. Could not parse JSON.\";\n      }\n      // console.log(data);\n      dispatch({\n        type: PlaygroundActionType.HttpResponse,\n        data: { status: res.status, data },\n      });\n    } catch (e) {\n      console.log(e);\n    }\n    setLoading(false);\n  };\n\n  const pathItems = route.path.split(\"/\");\n\n  return (\n    <ResizablePanelGroup direction=\"vertical\" className=\"\">\n      <ResizablePanel defaultSize={50} minSize={8} className=\"px-8 py-4\">\n        <div className=\"pb-4 text-neutral-400\">Request</div>\n        <div className=\"flex justify-between items-center\">\n          <div className=\"space-x-2 flex items-center\">\n            <HttpMethodBadge method={route.method}>\n              {route.method}\n            </HttpMethodBadge>\n            <div className=\"text-lg flex items-center\">\n              {pathItems.map((name, i) => (\n                <ApiRoutePathNode key={`${name}-${i}`} name={name} />\n              ))}\n            </div>\n          </div>\n          <Button loading={loading} onClick={() => submitRequest(route)}>\n            Send\n          </Button>\n        </div>\n        <Tabs className=\"mt-4 h-full\" defaultValue=\"headers\">\n          <TabsList>\n            <TabsTrigger value=\"headers\">Headers</TabsTrigger>\n            <TabsTrigger value=\"query\">Query</TabsTrigger>\n            <TabsTrigger value=\"body\">Body</TabsTrigger>\n            <TabsTrigger\n              value=\"params\"\n              className={\n                route.path\n                  .split(\"/\")\n                  .some((name) => extractPath(name).isDynamic)\n                  ? \"\"\n                  : \"hidden\"\n              }\n              alert={!route.params.every((kv) => !!kv.value)}\n            >\n              Params\n            </TabsTrigger>\n          </TabsList>\n          <div className=\"pb-36 h-full\">\n            <TabsContent value=\"headers\" className=\"h-full\">\n              <ScrollArea className=\"h-full\">\n                <KeyValueForm\n                  keyValues={route.headers}\n                  setKeyValues={onHeadersChange}\n                />\n              </ScrollArea>\n            </TabsContent>\n            <TabsContent value=\"query\" className=\"h-full\">\n              <ScrollArea className=\"h-full\">\n                <KeyValueForm\n                  keyValues={route.query}\n                  setKeyValues={onQueryChange}\n                />\n              </ScrollArea>\n            </TabsContent>\n            <TabsContent value=\"body\" className=\"h-full\">\n              <ContentBox>\n                <ScrollArea className=\"h-full\">\n                  <JsonEditor value={route.body} onChange={onBodyChange} />\n                </ScrollArea>\n              </ContentBox>\n            </TabsContent>\n            <TabsContent value=\"params\" className=\"h-full\">\n              <ScrollArea className=\"h-full\">\n                <KeyValueForm\n                  keyValues={route.params}\n                  setKeyValues={onRouteParamsChange}\n                  lockKeys\n                />\n              </ScrollArea>\n            </TabsContent>\n          </div>\n        </Tabs>\n      </ResizablePanel>\n      <ResizableHandle />\n      <ResizablePanel defaultSize={50} minSize={3} className=\"py-4 px-8\">\n        <div className=\"text-neutral-400 pb-4\">Response</div>\n        {!!route.lastResponse ? (\n          <div className=\"pb-14 w-full h-full\">\n            <div className=\"mb-4\">\n              <HttpStatusBadge code={route.lastResponse!.status} />\n            </div>\n            <div className=\"pb-6 w-full h-full\">\n              <ContentBox>\n                <ScrollArea className=\"h-full\">\n                  <JsonEditor\n                    value={JSON.stringify(route.lastResponse!.data)}\n                    // disabled\n                  />\n                </ScrollArea>\n              </ContentBox>\n            </div>\n          </div>\n        ) : (\n          <div className=\"pb-10 w-full h-full\">\n            <ContentBox>\n              <div className=\"p-2 w-full h-full flex flex-col justify-center text-center text-neutral-600 dark:text-neutral-400\">\n                {loading\n                  ? \"Awaiting response...\"\n                  : \"Press Send to get a response\"}\n              </div>\n            </ContentBox>\n          </div>\n        )}\n      </ResizablePanel>\n    </ResizablePanelGroup>\n  );\n}\n"]}